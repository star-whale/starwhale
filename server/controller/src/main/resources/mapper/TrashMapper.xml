<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright 2022 Starwhale, Inc. All Rights Reserved.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="ai.starwhale.mlops.domain.trash.mapper.TrashMapper">
  <insert id="insert" parameterType="ai.starwhale.mlops.domain.trash.po.TrashPo"
    useGeneratedKeys="true" keyProperty="id">
    insert into trash(project_id, object_id, operator_id, trash_name, trash_type, retention,
                      updated_time)
    values (#{projectId}, #{objectId}, #{operatorId}, #{trashName}, #{trashType}, #{retention},
            #{updatedTime})
  </insert>
  <delete id="delete">
    delete
    from trash
    where id = #{id}
  </delete>
  <select id="find" resultType="ai.starwhale.mlops.domain.trash.po.TrashPo">
    select id,
           project_id,
           object_id,
           operator_id,
           trash_name,
           trash_type,
           size,
           retention,
           updated_time,
           created_time,
           modified_time
    from trash
    where id = #{id}
  </select>
  <select id="list" resultType="ai.starwhale.mlops.domain.trash.po.TrashPo">
    select id,
           project_id,
           object_id,
           operator_id,
           trash_name,
           trash_type,
           size,
           retention,
           updated_time,
           created_time,
           modified_time
    from trash
    where project_id = #{projectId}
    <if test="operatorId != null">
      and operator_id = #{operatorId}
    </if>
    <if test="name != null and name != ''">
      and trash_name like concat(#{name}, '%')
    </if>
    <if test="type != null and type != ''">
      and trash.trash_type = #{type}
    </if>
    order by id desc
  </select>
</mapper>