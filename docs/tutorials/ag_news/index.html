<!doctype html>
<html lang="en-US" dir="ltr" class="docs-wrapper docs-doc-page docs-version-0.4.0 plugin-docs plugin-id-default docs-doc-id-tutorials/ag_news">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Text Classification on AG News dataset | Starwhale</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://doc.starwhale.ai/docs/tutorials/ag_news"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="0.4.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-0.4.0"><meta data-rh="true" name="docsearch:version" content="0.4.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-0.4.0"><meta data-rh="true" property="og:title" content="Text Classification on AG News dataset | Starwhale"><meta data-rh="true" name="description" content="This example illustrates how to evaluate a pre-trained text classification model on Starwhale in 6 steps."><meta data-rh="true" property="og:description" content="This example illustrates how to evaluate a pre-trained text classification model on Starwhale in 6 steps."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://doc.starwhale.ai/docs/tutorials/ag_news"><link data-rh="true" rel="alternate" href="https://doc.starwhale.ai/docs/tutorials/ag_news" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://doc.starwhale.ai/zh/docs/tutorials/ag_news" hreflang="zh"><link data-rh="true" rel="alternate" href="https://doc.starwhale.ai/docs/tutorials/ag_news" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=none"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","none",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.829d5971.css">
<link rel="preload" href="/assets/js/runtime~main.624ae07f.js" as="script">
<link rel="preload" href="/assets/js/main.e2e54093.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you like <b>Starwhale</b>, <a target="_blank" rel="noopener noreferrer" href="https://github.com/star-whale/starwhale">give us a star on GitHub!</a> 🌺</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/quickstart/standalone"><div class="navbar__logo"><img src="/img/starwhale-white.png" alt="Starwhale" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/starwhale-white.png" alt="Starwhale" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"> </b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/quickstart/standalone">0.4.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/tutorials/ag_news">WIP</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/tutorials/ag_news">0.4.0</a></li></ul></div><a href="https://github.com/star-whale/starwhale" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-ico header-ico--github" aria-label="GitHub repository">Github</a><a href="https://starwhale.slack.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-ico header-ico--slack" aria-label="Slack Channel">Slack</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/tutorials/ag_news" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-US">English</a></li><li><a href="/zh/docs/tutorials/ag_news" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh">中文</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/docs/quickstart/standalone"><img src="/img/starwhale-white.png" alt="Starwhale" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/starwhale-white.png" alt="Starwhale" class="themedImage_ToTc themedImage--dark_i4oU"><b> </b></a><nav class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/quickstart/standalone">Quickstart</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/tutorials/pytorch">Tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/pytorch">Pytorch Starwhale Runtime Build</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/mnist">MNIST with Pytorch</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/speech">Audio Classification on Speech Commands Dataset</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/tutorials/ag_news">Text Classification on AG News dataset</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/cifar10">Image Classification on CIFAR-10</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/pfp">Object Detection &amp; segmentation on PennFudanPed dataset</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/nmt">NMT for french and english</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/ucf101">Multi-Fiber Networks(MFNet) For UCF101</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/fundamentals/concepts">Fundamentals</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/guides/uri">Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/reference/cli/basic">Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/community/contribute">Community</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Tutorials</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Text Classification on AG News dataset</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 0.4.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Text Classification on AG News dataset</h1></header><p>This example illustrates how to evaluate a pre-trained text classification model on Starwhale in 6 steps.</p><ol><li>Create a Runtime</li><li>Train the model</li><li>Implement the dataset slicing method</li><li>Implement the inference method and evaluation metrics computing method</li><li>Build Runtime, Dataset, and Model</li><li>Run the evaluation job and see the metrics</li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="prerequisites">Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">​</a></h2><ul><li><p>Assume that you have Python3.7 or above installed.</p></li><li><p>Clone the Starwhale repo</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">git</span><span class="token plain"> clone https://github.com/star-whale/starwhale.git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> starwhale/example/text_cls_AG_NEWS</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><blockquote><p>💡 If you are from the mainland of China, we strongly recommend you use a proxy.</p></blockquote><ul><li>Install <a href="/docs/quickstart/standalone">Starwhale</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="create-a-runtime">Create a Runtime<a class="hash-link" href="#create-a-runtime" title="Direct link to heading">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ swcli runtime create </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><span class="token plain"> --name pytorch_text -m venv --python</span><span class="token operator">=</span><span class="token number">3.9</span><span class="token plain"> --force --base-image ghcr.io/star-whale/starwhale:0.2.0-alpha.12</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🚧 start to create the runtime environment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🍰 run the following </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">command</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> your shell 🍰</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">source</span><span class="token plain"> ~/code/starwhale/example/text_cls_AG_NEWS/venv/bin/activate</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">👏 python runtime environment is ready to use 🎉</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">source</span><span class="token plain"> ~/code/starwhale/example/text_cls_AG_NEWS/venv/bin/activate</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pytorch_text</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> $  python3 -m pip </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -r requirements.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>💡 make sure python3.9-venv is installed if you choose --python=3.9
💡 <code>python3 -m pip install</code> is recommended over <code>pip install</code></p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="train-the-model">Train the model<a class="hash-link" href="#train-the-model" title="Direct link to heading">​</a></h2><blockquote><p>The training code in this repo is copied from <a href="https://pytorch.org/tutorials/beginner/text_sentiment_ngrams_tutorial.html" target="_blank" rel="noopener noreferrer">Pytorch Tutorial</a>. However, the dataset part is modified to understand better how Starwhale works.</p></blockquote><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">(pytorch_text) $ mkdir models</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(pytorch_text) $ cd code</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(pytorch_text) $ python train.py --device cpu --save-model-path  ../models/model.i --dictionary ../models/vocab.i --num-epochs 5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You will get the logs as below:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">| epoch   1 |   500/ 7125 batches | accuracy    0.385</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| epoch   1 |  1000/ 7125 batches | accuracy    0.660</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| epoch   1 |  1500/ 7125 batches | accuracy    0.771</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| epoch   1 |  2000/ 7125 batches | accuracy    0.813</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| epoch   1 |  2500/ 7125 batches | accuracy    0.842</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| epoch   1 |  3000/ 7125 batches | accuracy    0.860</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| epoch   1 |  3500/ 7125 batches | accuracy    0.852</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| epoch   1 |  4000/ 7125 batches | accuracy    0.869</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| epoch   1 |  4500/ 7125 batches | accuracy    0.875</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| epoch   1 |  5000/ 7125 batches | accuracy    0.876</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| epoch   1 |  5500/ 7125 batches | accuracy    0.884</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| epoch   1 |  6000/ 7125 batches | accuracy    0.881</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| epoch   1 |  6500/ 7125 batches | accuracy    0.883</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| epoch   1 |  7000/ 7125 batches | accuracy    0.894</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----------------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| end of epoch   1 | time: 28.79s | valid accuracy    0.896</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----------------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| epoch   2 |   500/ 7125 batches | accuracy    0.922</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| epoch   2 |  1000/ 7125 batches | accuracy    0.915</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">......</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">......</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| epoch   5 |  6000/ 7125 batches | accuracy    0.918</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| epoch   5 |  6500/ 7125 batches | accuracy    0.925</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| epoch   5 |  7000/ 7125 batches | accuracy    0.922</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----------------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| end of epoch   5 | time: 27.34s | valid accuracy    0.900</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----------------------------------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Checking the results of test dataset.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">test accuracy    0.877</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Saving model to ../models/model.i</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Save vocab to ../models/vocab.i</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Great! Now you have your model trained and saved. You can see it in the <code>models</code> directory.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">(pytorch_text) $ ls ../models</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">model.i  vocab.i</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="slice-the-test-dataset-using-the-starwhale-protocol">Slice the test dataset using the Starwhale protocol<a class="hash-link" href="#slice-the-test-dataset-using-the-starwhale-protocol" title="Direct link to heading">​</a></h2><p>In the training section, we use a dataset called <a href="https://paperswithcode.com/dataset/ag-news" target="_blank" rel="noopener noreferrer">AG_NEWS</a>.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">(pytorch_text) $ ls ../data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">test.csv  train.csv</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The test part of the dataset is a file called <code>test.csv</code>, which contains 7,600 lines of texts and labels.</p><p>Before version <code>0.2.x</code>, Starwhale sliced the dataset into chunks where the batched texts and labels reside. You must tell Starwhale how to yield batches of byte arrays from each dataset file.</p><p>In this example, we will read texts and labels in batch and convert them into byte arrays.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">yield_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> label</span><span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    data </span><span class="token operator">=</span><span class="token plain"> ag_news</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">load_ag_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    idx </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    data_size </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">len</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">while</span><span class="token plain"> </span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        last_idx </span><span class="token operator">=</span><span class="token plain"> idx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        idx </span><span class="token operator">+=</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> idx </span><span class="token operator">&gt;</span><span class="token plain"> data_size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        data_batch </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">lbl </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> label </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> txt </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> lbl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> txt </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                      data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">last_idx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">idx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        join </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;#@#@#@#&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">data_batch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">yield</span><span class="token plain"> join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">AGNEWSSlicer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">BuildExecutor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">iter_data_slice</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">yield</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> yield_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">iter_label_slice</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">str</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">yield</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> yield_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You need to extend the abstract class <code>BuildExecutor</code>, so Starwhale can use it. The <code>path</code> argument is a file that matches <code>data_filter</code> or <code>label_filter</code> in <code>${code_base}/example/text_cls_AG_NEWS/dataset.yaml</code>. The filters used in this example are <code>test.csv</code>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="implement-the-inference-method-and-evaluation-metrics-computing-method">Implement the inference method and evaluation metrics computing method<a class="hash-link" href="#implement-the-inference-method-and-evaluation-metrics-computing-method" title="Direct link to heading">​</a></h2><p>The inference method is called <code>ppl,</code> and the evaluation metrics computing method is called <code>cmp</code>.
Here is the code snap from <code>ppl.py</code>, which implements both methods. You need to extend the abstract class <code>PipelineHandler</code> so you can receive the byte arrays, which you transformed in the last step.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">TextClassificationHandler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">PipelineHandler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> device</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;cpu&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin" style="color:rgb(189, 147, 249)">super</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">merge_label</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> ignore_error</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">device </span><span class="token operator">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">device</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">device</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">@torch</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">no_grad</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ppl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">**</span><span class="token plain">kw</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        _model</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> vocab</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> tokenizer </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_load_model</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">device</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        texts </span><span class="token operator">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">decode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">split</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;#@#@#@#&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">list</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">lambda</span><span class="token plain"> text</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> predict</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> _model</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> vocab</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> tokenizer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> texts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">handle_label</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> label</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">**</span><span class="token plain">kw</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        labels </span><span class="token operator">=</span><span class="token plain"> label</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">decode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">split</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;#@#@#@#&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token builtin" style="color:rgb(189, 147, 249)">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">label</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> label </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> labels</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">@multi_classification</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        confusion_matrix_normalize</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;all&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        show_hamming_loss</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        show_cohen_kappa_score</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        show_roc_auc</span><span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        all_labels</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">i </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> i </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">range</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">cmp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> _data_loader</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        _result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> _label </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> _data </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> _data_loader</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            _label</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">extend</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token builtin" style="color:rgb(189, 147, 249)">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">l</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> l </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> _data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;label&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            _result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">extend</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token builtin" style="color:rgb(189, 147, 249)">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> r </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> _data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;result&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> _label</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> _result</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">_load_model</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> device</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        model_path </span><span class="token operator">=</span><span class="token plain"> _ROOT_DIR </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/models/model.i&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        _model </span><span class="token operator">=</span><span class="token plain"> model</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">TextClassificationModel</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1308713</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">to</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">device</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        _model</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">load_state_dict</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">torch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">load</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">model_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        _model</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">eval</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        vocab_path </span><span class="token operator">=</span><span class="token plain"> _ROOT_DIR </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/models/vocab.i&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        dictionary </span><span class="token operator">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">load</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">vocab_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        tokenizer </span><span class="token operator">=</span><span class="token plain"> get_tokenizer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;basic_english&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> _model</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dictionary</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> tokenizer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="implement-ppl">Implement ppl<a class="hash-link" href="#implement-ppl" title="Direct link to heading">​</a></h3><p>Starwhale will feed the byte arrays of one batch to the <code>ppl</code> method and put the output of <code>ppl</code> into an <code>inference_result</code> dict, which looks like:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token property">&quot;result&quot;</span><span class="token operator">:</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">resultObj1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">resultObj2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">labelObj1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">labelObj2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Starwhale will automatically add the result of <code>ppl</code> to <code>inference_result.result</code> and the result of <code>handle_label</code> to <code>inference_result.label</code>.</p><p>The <code>inference_result</code> is used in the argument of <code>cmp</code> named <code>_data_loader</code>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="implement-cmp">Implement cmp<a class="hash-link" href="#implement-cmp" title="Direct link to heading">​</a></h3><p><code>_data_loader</code> is an iterator for <code>result</code> and <code>label</code>. For a multiple classification problem, it is pretty easy to implement the <code>cmp</code> method by annotating your <code>cmp</code> method with the <code>multi_classification</code> annotation and coping the lines inside it. Because AG_NEWS has only 4 labels, <code>all_labels</code> is set to <code>[i for i in range(1, 5)]</code></p><p>If you need to show <code>roc</code> and <code>auc</code>, you will also need to supply <code>_pr</code> in your <code>ppl</code> method.</p><p>By now, we have finished all the coding parts. Then let&#x27;s begin the command line part.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="build-runtime-model-and-dataset">Build Runtime, Model, and Dataset<a class="hash-link" href="#build-runtime-model-and-dataset" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="build-runtime">Build Runtime<a class="hash-link" href="#build-runtime" title="Direct link to heading">​</a></h3><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">(pytorch_text) $ cd ..</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(pytorch_text) $ swcli runtime build .</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🚧 start to build runtime bundle...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">👷 uri:local/project/self/runtime/pytorch_text</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🐦 runtime will ignore pypi editable package</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🆕 version mnqtgyjrhezd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">📁 workdir: ~/.cache/starwhale/self/workdir/runtime/pytorch_text/mn/mnqtgyjrhezdmodbmu4tezrsgvvdgmq</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">💫 python3.9.5@venv, os(Linux), include-editable(False), try to export environment...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🌈 runtime docker image: ghcr.io/star-whale/starwhale:0.2.0-alpha.  🌈</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🦋 .swrt bundle:~/.cache/starwhale/self/runtime/pytorch_text/mn/mnqtgyjrhezdmodbmu4tezrsgvvdgmq.swrt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="build-dataset">Build Dataset<a class="hash-link" href="#build-dataset" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="write-the-yaml-file">Write the yaml file<a class="hash-link" href="#write-the-yaml-file" title="Direct link to heading">​</a></h4><p>Here is some descriptive information needed for Starwhale to build a Starwhale Dataset(SWDS). A yaml file describes the information as below:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> AG_NEWS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">data_dir</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">data_filter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;test.csv&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">label_filter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;test.csv&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">process</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> code.data_slicer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">AGNEWSSlicer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">pip_req</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> requirements.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">desc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> AG_NEWS data and label test dataset</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> bin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">attr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">alignment_size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 4k</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">volume_size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 2M</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Most of the fields are self-explained. The <code>process</code> descriptor is the entry point of the data split method. The <code>data_filter</code> is for searching files containing data named like <code>test.csv</code> recursively under <code>data_dir</code>. Then Starwhale will use the files found as the input for <code>process</code>.</p><p>After creating the yaml file under <code>${code_base}/example/text_cls_AG_NEWS/</code>, we are ready.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ swcli dataset build .</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🚧 start to build dataset bundle...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">👷 uri:local/project/self/dataset/ag_news</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🆕 version gaygeyrsmi2w</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">📁 swds workdir: ~/.cache/starwhale/self/dataset/ag_news/ga/gaygeyrsmi2wcmrsmuydgy3enrzdm5i.swds</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">👍 try to copy source code files...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">👻 import code.data_slicer:AGNEWSSlicer@~/code/starwhale/example/text_cls_AG_NEWS to make swds...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cleanup done.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">finish gen swds @ ~/.cache/starwhale/self/dataset/ag_news/ga/gaygeyrsmi2wcmrsmuydgy3enrzdm5i.swds/data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🤖 calculate signature...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🌺 congratulation! you can run  swcli dataset info ag_news/version/gaygeyrsmi2wcmrsmuydgy3enrzdm5i</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  8 out of 8 steps finished ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00 0:00:00</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There is one more step left.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="build-model">Build Model<a class="hash-link" href="#build-model" title="Direct link to heading">​</a></h3><p>Here is some descriptive information for Starwhale to build a Starwhale Model Package(SWMP). A yaml file describes the information as below:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">1.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> text_cls</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">model</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> models/model.i</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> models/vocab.i</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> config/hyperparam.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">run</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">ppl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> code.ppl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">TextClassificationHandler</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">pip_req</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> requirements.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">exclude_pkg_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> venv</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> .git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> .history</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> .vscode</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">desc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> TextClassification by PyTorch</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> TextClassification</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Most of the fields are self-explained. The <code>ppl</code> descriptor is the entry point of the inference and cmp method.
After creating the yaml file under <code>${code_base}/example/text_cls_AG_NEWS/</code>, we are ready.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">(pytorch_text) $ swcli model build .</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🚧 start to build model bundle...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">👷 uri:local/project/self/model/text_cls</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🆕 version mq2tmmlfgmzd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">📁 workdir: ~/.cache/starwhale/self/workdir/model/text_cls/mq/mq2tmmlfgmzdqztfgbqtmntfg53dk4a</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">👍 try to copy source code files...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🦋 .swmp bundle:~/.cache/starwhale/self/model/text_cls/mq/mq2tmmlfgmzdqztfgbqtmntfg53dk4a.swmp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here we are. We have finished all the complex parts.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="run-the-evaluation-job-and-see-the-metrics">Run the evaluation job and see the metrics<a class="hash-link" href="#run-the-evaluation-job-and-see-the-metrics" title="Direct link to heading">​</a></h2><p>We have two ways to evaluate our models:</p><ul><li>Evaluate model on a standalone instance</li><li>Evaluate model on a cloud instance</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="evaluate-the-model-on-your-local-standalone-instance">Evaluate the model on your local standalone instance<a class="hash-link" href="#evaluate-the-model-on-your-local-standalone-instance" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="create-a-job">Create a job<a class="hash-link" href="#create-a-job" title="Direct link to heading">​</a></h4><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ swcli -vvv job create self --model text_cls/version/latest --dataset ag_news/version/latest --runtime pytorch_text/version/latest --docker-verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2022-06-09 19:09:45.085 | 0:00:01.898337 | DEBUG    | starwhale.utils.debug:init_logger:42 - verbosity: 3, log level: DEBUG</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">⠋ eval run in local... ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   0% -:--:-- 0:00:002022-06-09 19:09:45.090 | 0:00:01.903792 | INFO     | starwhale.core.job.executor:_gen_version:113 - [step:version]create eval job version...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2022-06-09 19:09:45.093 | 0:00:01.906845 | INFO     | starwhale.core.job.executor:_gen_version:118 - [step:version]eval job version is mfrdcyrxhftdgzlgmqytsmbsnvztiyq</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2022-06-09 19:09:45.093 | 0:00:01.907084 | INFO     | starwhale.core.job.executor:_prepare_workdir:129 - [step:prepare]create eval workdir...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2022-06-09 19:09:45.095 | 0:00:01.908800 | INFO     | starwhale.core.job.executor:_prepare_workdir:151 - [step:prepare]eval workdir: ~/.cache/starwhale/self/job/mf/mfrdcyrxhftdgzlgmqytsmbsnvztiyq</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">😹 ~/.cache/starwhale/self/workdir/model/text_cls/gz/gzstmmztmyytmztfgbqtmntfn43gqoi existed, skip extract model bundle</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">😹 ~/.cache/starwhale/self/workdir/runtime/pytorch_text/hb/hbtdqnztmy2dky3cmqzdazjymn4dqzi existed, skip extract model bundle</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">😹 local_fuse.json existed, skip render</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🔍 ~/.cache/starwhale/self/dataset/ag_news/me/me3tkzdgga4tgmrsmuydgy3ehfshu6i.swds/local_fuse.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">⠋ eval run in local... ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   0% -:--:-- 0:00:002022-06-09 19:09:45.106 | 0:00:01.919282 | DEBUG    | starwhale.core.job.executor:_gen_swds_fuse_json:166 - [gen fuse input.json]~/.cache/starwhale/self/dataset/ag_news/me/me3tkzdgga4tgmrsmuydgy3ehfshu6i.swds/local_fuse.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2022-06-09 19:09:45.106 | 0:00:01.919864 | INFO     | starwhale.core.job.executor:_do_run_cmd:217 - [run ppl] docker run command output...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🐘 ppl docker cmd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker run --net=host --rm --name mfrdcyrxhftdgzlgmqytsmbsnvztiyq-ppl -v ~/.cache/starwhale/self/job/mf/mfrdcyrxhftdgzlgmqytsmbsnvztiyq/ppl:/opt/starwhale -v ~/.cache/starwhale/self/workdir/model/text_cls/gz/gzstmmztmyytmztfgbqtmntfn43gqoi/src:/opt/starwhale/swmp/src -v ~/.cache/starwhale/self/workdir/model/text_cls/gz/gzstmmztmyytmztfgbqtmntfn43gqoi/model.yaml:/opt/starwhale/swmp/model.yaml -v ~/.cache/starwhale/self/workdir/runtime/pytorch_text/hb/hbtdqnztmy2dky3cmqzdazjymn4dqzi/dep:/opt/starwhale/swmp/dep -v ~/.cache/starwhale/self/workdir/runtime/pytorch_text/hb/hbtdqnztmy2dky3cmqzdazjymn4dqzi/_manifest.yaml:/opt/starwhale/swmp/_manifest.yaml -v ~/.cache/starwhale/self/dataset:/opt/starwhale/dataset -v ~/.cache/starwhale-pip:/root/.cache/pip -e DEBUG=1 ghcr.io/star-whale/starwhale:latest ppl</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🐟 eval run:ppl dir @ ~/.cache/starwhale/self/job/mf/mfrdcyrxhftdgzlgmqytsmbsnvztiyq/ppl</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">⠋ eval run in local... ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   0% -:--:-- 0:00:002022-06-09 19:09:45.116 | 0:00:01.929534 | DEBUG    | starwhale.utils.process:log_check_call:20 - cmd: &#x27;docker pull ghcr.io/star-whale/starwhale:latest&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">......logs omitted......</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">......logs omitted......</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">⠼ run ppl... ━━━━━━━━━━╸━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  26% 0:00:01 0:08:252022-06-09 19:18:11.233 | 0:08:28.046963 | DEBUG    | starwhale.utils.process:log_check_call:25 - 2022-06-09 11:18:11.232 | 0:04:30.197662 | INFO     | starwhale.api._impl.model:_starwhale_internal_run_ppl:268 - [115] data handle -&gt; success</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2022-06-09 19:18:11.234 | 0:08:28.047501 | DEBUG    | starwhale.utils.process:log_check_call:25 - 2022-06-09 11:18:11.233 | 0:04:30.198691 | INFO     | starwhale.api._impl.model:_starwhale_internal_run_ppl:229 - [116]data-label loaded, data size:14.73KB, label size:505.00B ,batch:64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">⠦ run ppl... ━━━━━━━━━━╸━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  26% 0:00:01 0:08:262022-06-09 19:18:12.375 | 0:08:29.188626 | DEBUG    | starwhale.utils.process:log_check_call:25 - 2022-06-09 11:18:12.374 | 0:04:31.339085 | INFO     | starwhale.api._impl.model:_starwhale_internal_run_ppl:268 - [116] data handle -&gt; success</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2022-06-09 19:18:12.377 | 0:08:29.190733 | DEBUG    | starwhale.utils.process:log_check_call:25 - 2022-06-09 11:18:12.377 | 0:04:31.341953 | INFO     | starwhale.api._impl.model:_starwhale_internal_run_ppl:229 - [117]data-label loaded, data size:15.06KB, label size:505.00B ,batch:64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">⠏ run ppl... ━━━━━━━━━━╸━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  26% 0:00:01 0:08:272022-06-09 19:18:13.661 | 0:08:30.474491 | DEBUG    | starwhale.utils.process:log_check_call:25 - 2022-06-09 11:18:13.660 | 0:04:32.625002 | INFO     | starwhale.api._impl.model:_starwhale_internal_run_ppl:268 - [117] data handle -&gt; success</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2022-06-09 19:18:13.662 | 0:08:30.475502 | DEBUG    | starwhale.utils.process:log_check_call:25 - 2022-06-09 11:18:13.661 | 0:04:32.626688 | INFO     | starwhale.api._impl.model:_wrapper:209 - finish.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2022-06-09 19:18:13.663 | 0:08:30.477178 | DEBUG    | starwhale.utils.process:log_check_call:25 - 2022-06-09 11:18:13.663 | 0:04:32.628394 | Level 20 | rich.console:_check_buffer:1951 - 👏 finish run ppl: PipelineHandler status@/opt/starwhale/status, log@/opt/starwhale/log, result@/opt/starwhale/result</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2022-06-09 19:18:13.853 | 0:08:30.666685 | DEBUG    | starwhale.utils.process:log_check_call:25 - 👏 finish run ppl: PipelineHandler status@/opt/starwhale/status, log@/opt/starwhale/log, result@/opt/starwhale/result</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2022-06-09 19:18:14.033 | 0:08:30.846635 | DEBUG    | starwhale.utils.process:log_check_call:25 -</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2022-06-09 19:18:14.034 | 0:08:30.848083 | INFO     | starwhale.core.job.executor:_do_run_cmd:217 - [run cmp] docker run command output...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🐘 cmp docker cmd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker run --net=host --rm --name mfrdcyrxhftdgzlgmqytsmbsnvztiyq-cmp -v ~/.cache/starwhale/self/job/mf/mfrdcyrxhftdgzlgmqytsmbsnvztiyq/cmp:/opt/starwhale -v ~/.cache/starwhale/self/workdir/model/text_cls/gz/gzstmmztmyytmztfgbqtmntfn43gqoi/src:/opt/starwhale/swmp/src -v ~/.cache/starwhale/self/workdir/model/text_cls/gz/gzstmmztmyytmztfgbqtmntfn43gqoi/model.yaml:/opt/starwhale/swmp/model.yaml -v ~/.cache/starwhale/self/workdir/runtime/pytorch_text/hb/hbtdqnztmy2dky3cmqzdazjymn4dqzi/dep:/opt/starwhale/swmp/dep -v ~/.cache/starwhale/self/workdir/runtime/pytorch_text/hb/hbtdqnztmy2dky3cmqzdazjymn4dqzi/_manifest.yaml:/opt/starwhale/swmp/_manifest.yaml -v ~/.cache/starwhale/self/job/mf/mfrdcyrxhftdgzlgmqytsmbsnvztiyq/ppl/result:/opt/starwhale/ppl_result -v ~/.cache/starwhale-pip:/root/.cache/pip -e DEBUG=1 ghcr.io/star-whale/starwhale:latest cmp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🐟 eval run:cmp dir @ ~/.cache/starwhale/self/job/mf/mfrdcyrxhftdgzlgmqytsmbsnvztiyq/cmp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">⠙ run cmp... ━━━━━━━━━━━━━━━━━━━━━━━━━╺━━━━━━━━━━━━━━  63% -:--:-- 0:08:282022-06-09 19:18:14.043 | 0:08:30.856355 | DEBUG    | starwhale.utils.process:log_check_call:20 - cmd: &#x27;docker pull ghcr.io/star-whale/starwhale:latest&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">......logs omitted......</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">......logs omitted......</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2022-06-09 19:18:23.015 | 0:08:39.828563 | DEBUG    | starwhale.utils.process:log_check_call:25 - 2022-06-09 11:18:23.013 | 0:00:01.444597 | INFO     | starwhale.api._impl.model:_wrapper:209 - finish.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">⠼ run cmp... ━━━━━━━━━━━━━━━━━━━━━━━━━╺━━━━━━━━━━━━━━  63% -:--:-- 0:08:372022-06-09 19:18:23.159 | 0:08:39.972502 | DEBUG    | starwhale.utils.process:log_check_call:25 - 2022-06-09 11:18:23.014 | 0:00:01.445667 | Level 20 | rich.console:_check_buffer:1951 - 👏 finish run cmp: PipelineHandler status@/opt/starwhale/status, log@/opt/starwhale/log, result@/opt/starwhale/result</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2022-06-09 19:18:23.159 | 0:08:39.972795 | DEBUG    | starwhale.utils.process:log_check_call:25 - {&#x27;index&#x27;: 116, &#x27;result&#x27;: [2, 3, 1, 4, 2, 4, 3, 3, 2, 2, 2, 2, 1, 1, 3, 4, 1, 3, 2, 1, 3, 2, 1, 2, 3, 3, 3, 3, 3, 4, 2, 3, 4, 2, 1, 1, 1, 1, 3, 3, 3, 3, 3, 1, 3, 1, 4, 2, 4, 1, 1, 1, 1, 1, 4, 1, 3, 1, 1, 1, 3, 4, 2, 2], &#x27;pr&#x27;: None, &#x27;batch&#x27;: 64, &#x27;label&#x27;: [2, 3, 4, 4, 2, 4, 3, 3, 2, 2, 2, 2, 1, 4, 3, 4, 4, 3, 2, 1, 3, 2, 3, 2, 3, 3, 3, 3, 3, 4, 2, 3, 4, 2, 1, 1, 1, 4, 3, 3, 3, 3, 4, 1, 3, 4, 3, 1, 4, 1, 1, 2, 1, 1, 4, 2, 3, 4, 1, 1, 2, 4, 2, 2]}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2022-06-09 19:18:23.314 | 0:08:40.128161 | DEBUG    | starwhale.utils.process:log_check_call:25 - {&#x27;index&#x27;: 117, &#x27;result&#x27;: [3, 2, 1, 4, 1, 4, 4, 1, 1, 4, 1, 4, 2, 3, 1, 3, 4, 1, 2, 3, 3, 1, 1, 3, 1, 4, 4, 1, 1, 2, 4, 1, 4, 4, 3, 3, 3, 2, 1, 4, 2, 1, 3, 2, 2, 1, 1, 3, 1, 3, 1, 4, 1, 4, 3, 1, 1, 1, 4, 3, 3, 3, 1, 2], &#x27;pr&#x27;: None, &#x27;batch&#x27;: 64, &#x27;label&#x27;: [3, 2, 1, 4, 3, 4, 4, 1, 3, 4, 4, 4, 2, 3, 1, 3, 4, 1, 2, 3, 3, 1, 1, 3, 1, 4, 4, 3, 1, 2, 4, 1, 4, 4, 4, 3, 3, 2, 1, 4, 2, 1, 3, 2, 2, 1, 1, 3, 1, 3, 1, 1, 1, 4, 4, 3, 1, 1, 4, 3, 3, 3, 2, 2]}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  7 out of 7 steps finished ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00 0:08:38</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">👏 success to create job(project id: self)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="see-the-metrics">See the metrics<a class="hash-link" href="#see-the-metrics" title="Direct link to heading">​</a></h4><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">(pytorch_text) $ swcli job info mfrdcyrxhftdgzlgmqytsmbsnvztiyq</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;created_at&#x27;: &#x27;2022-06-09 19:09:45 CST&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;datasets&#x27;: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &#x27;local/project/self/dataset/ag_news/version/latest&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;desc&#x27;: None,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;finished_at&#x27;: &#x27;2022-06-09 19:18:23 CST&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;model&#x27;: &#x27;local/project/self/model/text_cls/version/latest&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;name&#x27;: None,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;phase&#x27;: &#x27;all&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;runtime&#x27;: &#x27;local/project/self/runtime/pytorch_text/version/latest&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;status&#x27;: &#x27;success&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;version&#x27;: &#x27;mfrdcyrxhftdgzlgmqytsmbsnvztiyq&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🌵 ppl: ~/.cache/starwhale/self/job/mf/mfrdcyrxhftdgzlgmqytsmbsnvztiyq/ppl</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🐫 cmp: ~/.cache/starwhale/self/job/mf/mfrdcyrxhftdgzlgmqytsmbsnvztiyq/cmp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Summary</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── accuracy: 0.8059                                                                                   Label   Precision   Recall   F1-score   Support</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── macro avg                                                                                         ───────────────────────────────────────────────────</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   ├── precision: 0.8427                                                                              1       0.6313      0.9487   0.7581     3780.0000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   ├── recall: 0.8059                                                                                 2       0.9610      0.8110   0.8797     3768.0000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   ├── f1-score: 0.8098                                                                               3       0.8554      0.7834   0.8178     3776.0000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   └── support: 15104.0000                                                                            4       0.9232      0.6804   0.7834     3780.0000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── weighted avg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   ├── precision: 0.8426</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   ├── recall: 0.8059</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   ├── f1-score: 0.8097</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   └── support: 15104.0000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── hamming_loss: 0.1941</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└── cohen_kappa_score: 0.7412</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Label   TP      TN     FP     FN                                                                                                            1        2        3        4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> ────────────────────────────────────                                                                                                    ───────────────────────────────────────</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  1       9230    2094   194    3586                                                                                                      1   0.2374   0.0048   0.0061   0.0020</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  2       11212   124    712    3056                                                                                                      2   0.0446   0.2023   0.0021   0.0004</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  3       10828   500    818    2958                                                                                                      3   0.0413   0.0011   0.1958   0.0118</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  4       11110   214    1208   2572                                                                                                      4   0.0527   0.0024   0.0249   0.1703</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>💡 Docker is required to run as a demon service on the machine</p></blockquote><p>Congratulations, we have finished the whole example! From now on, we can update the training method, get a new model, build a new SWMP, and evaluate our model from time to time.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="evaluate-model-on-a-cloud-instance">Evaluate model on a cloud instance<a class="hash-link" href="#evaluate-model-on-a-cloud-instance" title="Direct link to heading">​</a></h3><ul><li><strong>Log in to one cloud instance</strong></li></ul><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">(pytorch_text) $ swcli instance login http://console.pre.intra.starwhale.ai --username starwhale --password abcd1234 --alias pre-k8s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‍🍳 login http://console.pre.intra.starwhale.ai successfully!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>Copy the model we built before to the cloud instance</strong></li></ul><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">(pytorch_text) $ swcli model copy text_cls/version/gzstmmztmyyt cloud://pre-k8s/project/starwhale</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🚧 start to copy local/project/self/model/text_cls/version/gzstmmztmyyt -&gt; http://console.pre.intra.starwhale.ai/project/1...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  🎳 upload gzstmmztmyytmztfgbqtmntfn43gqoi.swmp ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:16 196.7 MB 10.6 MB/s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">👏 copy done.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>Copy the dataset we built before to the cloud instance</strong></li></ul><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">(pytorch_text) $ swcli dataset copy ag_news/version/me3tkzdgga4t cloud://pre-k8s/project/starwhale</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    🚧 start to copy local/project/self/dataset/ag_news/version/me3tkzdgga4t -&gt; http://console.pre.intra.starwhale.ai/project/1...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ⬆ _manifest.yaml         ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00 1.2 kB   ?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">⬆ data_ubyte_0.swds_bin  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00 2.0 MB   ?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">⬆ index.jsonl            ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00 20.9 kB  ?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">⬆ label_ubyte_0.swds_bin ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00 479.6 kB ?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">⬆ archive.swds_meta      ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00 20.5 kB  ?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">👏 copy done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>Copy the runtime we built before to the cloud instance</strong></li></ul><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">(pytorch_text) $ swcli runtime copy pytorch_text/version/hbtdqnztmy2d cloud://pre-k8s/project/starwhale</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">🚧 start to copy local/project/self/runtime/pytorch_text/version/hbtdqnztmy2d -&gt; http://console.pre.intra.starwhale.ai/project/1...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  🎳 upload hbtdqnztmy2dky3cmqzdazjymn4dqzi.swrt ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00 20.5 kB ?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">👏 copy done.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>Go to the console and create one job</strong></li></ul><p><img loading="lazy" alt="img.png" src="/assets/images/create_job_ag_news-467923671b4523073edceeacb47d569a.png" width="2560" height="1289" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/star-whale/starwhale/tree/main/docs/versioned_docs/version-0.4.0/tutorials/ag_news.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/tutorials/speech"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Audio Classification on Speech Commands Dataset</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/tutorials/cifar10"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Image Classification on CIFAR-10</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#create-a-runtime" class="table-of-contents__link toc-highlight">Create a Runtime</a></li><li><a href="#train-the-model" class="table-of-contents__link toc-highlight">Train the model</a></li><li><a href="#slice-the-test-dataset-using-the-starwhale-protocol" class="table-of-contents__link toc-highlight">Slice the test dataset using the Starwhale protocol</a></li><li><a href="#implement-the-inference-method-and-evaluation-metrics-computing-method" class="table-of-contents__link toc-highlight">Implement the inference method and evaluation metrics computing method</a><ul><li><a href="#implement-ppl" class="table-of-contents__link toc-highlight">Implement ppl</a></li><li><a href="#implement-cmp" class="table-of-contents__link toc-highlight">Implement cmp</a></li></ul></li><li><a href="#build-runtime-model-and-dataset" class="table-of-contents__link toc-highlight">Build Runtime, Model, and Dataset</a><ul><li><a href="#build-runtime" class="table-of-contents__link toc-highlight">Build Runtime</a></li><li><a href="#build-dataset" class="table-of-contents__link toc-highlight">Build Dataset</a></li><li><a href="#build-model" class="table-of-contents__link toc-highlight">Build Model</a></li></ul></li><li><a href="#run-the-evaluation-job-and-see-the-metrics" class="table-of-contents__link toc-highlight">Run the evaluation job and see the metrics</a><ul><li><a href="#evaluate-the-model-on-your-local-standalone-instance" class="table-of-contents__link toc-highlight">Evaluate the model on your local standalone instance</a></li><li><a href="#evaluate-model-on-a-cloud-instance" class="table-of-contents__link toc-highlight">Evaluate model on a cloud instance</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="logo margin-bottom--sm"><div class="social"></div></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Starwhale, Inc. All rights reserved. </div></div></footer></div>
<script src="/assets/js/runtime~main.624ae07f.js"></script>
<script src="/assets/js/main.e2e54093.js"></script>
</body>
</html>