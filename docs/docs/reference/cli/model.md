---
title: Model
---

## Usage

```bash
swcli model [OPTIONS] COMMAND [ARGS]...
```

## Summary

- Commands for model lifecycle management.
- For standalone instance, `model` command use local disk to create, build and store **Starwhale Model**.
- For cloud instance, `model` command manage the remote cloud models with HTTP API.
- **Model URI** in format: `[<Project URI>/model]<model name>[/version/<version id>]`.

## All Sub-Commands

  |Command|Standalone|Cloud|
  |-------|----------|-----|
  |build|✅|❌|
  |cmp|✅|❌|
  |ppl|✅|❌|
  |eval|✅|❌|
  |remove|✅|✅|
  |recover|✅|✅|
  |list|✅|✅|
  |history|✅|✅|
  |info|✅|✅|
  |tag|✅|❌|
  |extract|✅|❌|
  |copy|✅|✅|

## Build a model

```bash
swcli model build [OPTIONS] WORKDIR
```

- This command builds a model with the specified working directory. The workdir must contains a `model.yaml`.
- Options:

    |Option|Alias Option|Required|Type|Default|Description|
    |------|--------|-------|-----------|-----|-----------|
    |`--project`|`-p`|❌|String|Selected project|Project URI|
    |`--runtime-yaml`|`-f`|❌|String|model.yaml|Model yaml filename, default is ${WORKDIR}/model.yaml|

- Example:

    ```bash
    ❯ swcli model build .
    🚧 start to build model bundle...
    👷 uri:local/project/self/model/mnist
    🆕 version gbstgnlgheyd
    📁 workdir: /home/liutianwei/.cache/starwhale/self/workdir/model/mnist/gb/gbstgnlgheydqnrtmftdgyjzpe4tezy
    👍 try to copy source code files...
    🦋 .swmp bundle:/home/liutianwei/.cache/starwhale/self/model/mnist/gb/gbstgnlgheydqnrtmftdgyjzpe4tezy.swmp
    6 out of 6 steps finished ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00 0:00:00
    ```

## Run model ppl

```bash
swcli model ppl [OPTIONS] TARGET
```

- This command will run ppl which is defined in the `run.ppl` field of the model.yaml. When you write a subclass of `starwhale.api.model.PipelineHandler`, the `ppl` class method is necessary and it will be called by `ppl` command.
- `TARGET` argument is required, `Model URI` or model workdir path is ok for `TARGET` argument. In Starwhale agent docker environment, only support workdir path.
- The Starwhale dataset is a precondition for the `ppl` command to run. You should run `swcli dataset render-fuse` to render `input.json` for the input of `ppl` command.
- Another precondition is the Starwhale runtime. The `ppl` command must run at the activated runtime environment.
- This command helps the developer to debug ppl process. More human friendly command to evaluate mode is `swcli job create` or `swcli model eval`.
- Options:

    |Option|Alias Option|Required|Type|Default|Description|
    |------|--------|-------|-----------|-----|-----------|
    |`--model-yaml`|`-f`|❌|String|model.yaml|Model yaml filename, default is ${MODEL_DIR}/model.yaml|
    |`--status-dir`|os env `SW_TASK_STATUS_DIR`|❌|String|/tmp/starwhale/ppl/status|ppl status dir|
    |`--log-dir`|os env `SW_TASK_LOG_DIR`|❌|String|/tmp/starwhale/ppl/log|ppl log dir|
    |`--result-dir`|os env `SW_TASK_RESULT_DIR`|❌|String|/tmp/starwhale/ppl/result|ppl result dir|
    |`--input-config`|os env `SW_TASK_INPUT_CONFIG`|❌|String|/tmp/starwhale/ppl/config/input.json|dataset input.json path or Dataset URI, which was generated by `swcli dataset render-fuse` command|

- Example:

    ```bash
    ❯ swcli model ppl . --input-config mnist/version/latest
    🏌 try to eval ppl @  ....
    try to import mnist.ppl:MNISTInference@....
    🗣  swcli python prefix:/usr, runtime env python prefix:/home/liutianwei/code/starwhale/example/mnist/venv, swcli will inject sys.path
    load mnist model, start to inference...
    👏 finish run ppl: PipelineHandler status@/tmp/starwhale/status, log@/tmp/starwhale/log, result@/tmp/starwhale/result
    ```

## Run model cmp

```bash
swcli model cmp [OPTIONS] TARGET
```

- This command will run cmp which is defined in the `run.ppl` field of the model.yaml. When you write a subclass of `starwhale.api.model.PipelineHandler`, the `cmp` class method is necessary and it will be called by `cmp` command.
- Compare inference output with label, then generate result jsonline file.
- `TARGET` argument is required, `Model URI` or model workdir path is ok for `TARGET` argument. In Starwhale agent docker environment, only support workdir path.
- The result of `ppl` command is a precondition for the `cmp` command to run. You should run `swcli model ppl` to generate ppl inference output, then write a input.json to describe the result path.
- Another precondition is the Starwhale runtime. The `ppl` command must run at the activated runtime environment.
- This command helps the developer to debug cmp process. More human friendly command to evaluate mode is `swcli job create` or `swcli model eval`.
- Options:

    |Option|Alias Option|Required|Type|Default|Description|
    |------|--------|-------|-----------|-----|-----------|
    |`--model-yaml`|`-f`|❌|String|model.yaml|Model yaml filename, default is ${MODEL_DIR}/model.yaml|
    |`--status-dir`|os env `SW_TASK_STATUS_DIR`|❌|String|/tmp/starwhale/cmp/status|cmp status dir|
    |`--log-dir`|os env `SW_TASK_LOG_DIR`|❌|String|/tmp/starwhale/cmp/log|cmp log dir|
    |`--result-dir`|os env `SW_TASK_RESULT_DIR`|❌|String|/tmp/starwhale/cmp/result|cmp result dir|
    |`--input-config`|os env `SW_TASK_INPUT_CONFIG`|❌|String|/tmp/starwhale/cmp/config/input.json|cmp input.json path|

- Example:

   ```bash
   ❯ swcli model cmp . --input-config test/ppl_output_fuse_smoke.json
    🏌 try to eval cmp @  ....
    try to import mnist.ppl:MNISTInference@....
    load mnist model, start to inference...
    👏 finish run cmp: PipelineHandler status@/tmp/starwhale/cmp/status, log@/tmp/starwhale/cmp/log, result@/tmp/starwhale/cmp/result
   ```

## Evaluate a model

```bash
swcli model eval [OPTIONS] MODEL
```

- This command creates a new job for model evaluation.
- `MODEL` argument is required,  `Model URI` or model workdir path is ok for `MODEL` argument.
- This command does not depend on docker, so you should activate python environment at first.
- `model eval` command is very helpful for you to write debug, debug ppl/cmp and evaluate model in standalone instance.
- Options:

    |Option|Alias Option|Required|Type|Default|Description|
    |------|--------|-------|-----------|-----|-----------|
    |`--dataset`||✅|String||one or more dataset uris are ok for evaluation|
    |`--name`||❌|String|""|evaluation job name|
    |`--desc`||❌|String|""|evaluation job description|
    |`--project`|`-p`|❌|String|Selected project|Project URI|

- Example:

    ```bash
    ❯ swcli model eval . --dataset mnist/version/latest
    😹 local_fuse.json existed, skip render
    🔍 /home/liutianwei/.cache/starwhale/self/dataset/mnist/gv/gvsgemdbhazwknrtmftdgyjzoaygynq.swds/local_fuse.json
    try to import mnist.ppl:MNISTInference@....
    load mnist model, start to inference...
    👏 finish run ppl: PipelineHandler status@/home/liutianwei/.cache/starwhale/self/job/hb/hbsdkzjzgvtgknjxmuzdiolfgz3ti4i/ppl/status, log@/home/liutianwei/.cache/starwhale/self/job/hb/hbsdkzjzgvtgknjxmuzdiolfgz3ti4i/ppl/log, result@/home/liutianwei/.cache/starwhale/self/job/hb/hbsdkzjzgvtgknjxmuzdiolfgz3ti4i/ppl/result
    try to import mnist.ppl:MNISTInference@....
    load mnist model, start to inference...
    👏 finish run cmp: PipelineHandler status@/home/liutianwei/.cache/starwhale/self/job/hb/hbsdkzjzgvtgknjxmuzdiolfgz3ti4i/cmp/status, log@/home/liutianwei/.cache/starwhale/self/job/hb/hbsdkzjzgvtgknjxmuzdiolfgz3ti4i/cmp/log, result@/home/liutianwei/.cache/starwhale/self/job/hb/hbsdkzjzgvtgknjxmuzdiolfgz3ti4i/cmp/result
    7 out of 7 steps finished ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00 0:00:05
    👏 success to create job(project id: local/project/self)
    🐦 run cmd to fetch job info: swcli job info hbsdkzjzgvtg
    ```

## List models

```bash
swcli model list [OPTIONS]
```

- This command lists all models in the project.
- Options:

    |Option|Alias Option|Required|Type|Default|Description|
    |------|--------|-------|-----------|-----|-----------|
    |`--project`|`-p`|❌|String|Selected project|Project URI|
    |`--fullname`||❌|Boolean|False|Show fullname of model version|
    |`--show-removed`||❌|Boolean|False|Show removed models|
    |`--page`||❌|Integer|1|Page number for model list|
    |`--size`||❌|Integer|20|Page size for model list|

## Get model info

```bash
swcli model info [OPTIONS] MODEL
```

- This command inspects the model details.
- `MODEL` argument uses the `Model URI` format, so you can inspect the whole model or a specified-version model.
- Options:

    |Option|Alias Option|Required|Type|Default|Description|
    |------|--------|-------|-----------|-----|-----------|
    |`--fullname`||❌|Boolean|False|Show version fullname|

## Show model history

```bash
swcli model history [OPTIONS] MODEL
```

- This command shows the history of a model, list all the versions of this model.
- `MODEL` argument uses the `Model URI` format.
- Options:

    |Option|Alias Option|Required|Type|Default|Description|
    |------|--------|-------|-----------|-----|-----------|
    |`--fullname`||❌|Boolean|False|Show version fullname|

- Example:

    ```bash
    ❯ swcli model history mnist --fullname
    ```

## Manage model tags

```bash
swcli model tag [OPTIONS] MODEL TAGS
```

- This command adds or removes tags on the specified version of a model.
- `MODEL` argument uses the `Model URI` format which must include `/version/{version id}` part.
- You can write one or more `TAG` arguments.
- Options:

    |Option|Alias Option|Required|Type|Default|Description|
    |------|--------|-------|-----------|-----|-----------|
    |`--remove`|`-r`|❌|Boolean|False|Remove tags|
    |`--quiet`|`-q`|❌|Boolean|False|Ignore tag name errors like name duplication, name absence|

- Example:

    ```bash
    ❯ swcli model tag mnist/version/hbtdenjxgm4g test v2
    ```

## Remove a model

```bash
swcli model remove [OPTIONS] MODEL
```

- This command removes a model, you can run `swcli model recover` to recover the removed models.
- `MODEL` argument uses the `Model URI` format, so you can remove the whole model or a specified-version model.
- Support short version or tag in `Model URI` format when you remove a model.
- Options:

    |Option|Alias Option|Required|Type|Default|Description|
    |------|--------|-------|-----------|-----|-----------|
    |`--force`|`-f`|❌|Boolean|False|Force to remove model|

- Example:

    ```bash
    ❯ swcli model remove mnist/version/v2
    continue to remove? [y/N]: y
    👏 do successfully
    ```

## Recover a model

```bash
swcli model recover [OPTIONS] MODEL
```

- This command recovers a removed model, you can run `swcli model list --show-removed` to fetch removed models.
- `MODEL` argument uses the `Model URI` format, so you can recover the whole model or a specified-version model.
- Only support full version in `Model URI` format when you recover a model.
- Options:

    |Option|Alias Option|Required|Type|Default|Description|
    |------|--------|-------|-----------|-----|-----------|
    |`--force`|`-f`|❌|Boolean|False|Force to recover model|

- Example:

    ```bash
    ❯ swcli model recover mnist/version/hbtdenjxgm4ggnrtmftdgyjzm43tioi
    👏 do successfully
    ```

## Extract model bundle

```bash
swcli model extract [OPTIONS] MODEL
```

- This command extracts the bundled model to target dir. When you copy a model from remote cloud instance to local standalone, you can extract it and then do some operations, such as update code, rebuild model.
- `MODEL` argument uses the `Model URI` format which must include `/version/{version id}` part.
- Options:

    |Option|Alias Option|Required|Type|Default|Description|
    |------|--------|-------|-----------|-----|-----------|
    |`--force`|`-f`|❌|Boolean|False|Force to extract model|
    |`--target-dir`||❌|String|Starwhale default model workdir|Extract target dir|

- Example:

    ```bash
    ❯ swcli model extract mnist/version/latest --force
    🚔 try to extract ...
    👏 extracted @ /home/liutianwei/.cache/starwhale/self/workdir/model/mnist/gb/gbstgnlgheydqnrtmftdgyjzpe4tezy 🎉
    ```

## Copy a model

```bash
swcli model copy [OPTIONS] SRC DEST
```

- This command copies a model to another place, either locally or remotely.
- `SRC` uses `Model URI`, which can locate one existed version of a model in standalone or cloud instance.
- `DEST` uses `Project URI`, which implies the storage project in destination instance. If `DEST` project has already stored the same name and version model, you can set `--force` argument to force update.
- Today this command supports copy model from standalone to cloud and from cloud to standalone. `standalone -> standalone`, `cloud -> cloud` no support.
- Options:

    |Option|Alias Option|Required|Type|Default|Description|
    |------|--------|-------|-----------|-----|-----------|
    |`--force`|`-f`|❌|Boolean|False|Force to copy model|

- Example: copy a model from local standalone to remote cloud(upload)

    ```bash
    ❯ swcli model copy mnist/version/latest cloud://pre-k8s/project/1
    🚧 start to copy local/project/self/model/mnist/version/latest -> http://console.pre.intra.starwhale.ai/project/1...
    🎳 upload gbstgnlgheydqnrtmftdgyjzpe4tezy.swmp ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00 4.9 MB
    👏 copy done.
    ```

- Example: copy a model from remote cloud to local standalone(download)

    ```bash
    ❯ swcli model copy cloud://pre-k8s/project/1/model/mnist/version/gbstgnlgheydqnrtmftdgyjzpe4tezy self --force
    🚧 start to copy http://console.pre.intra.starwhale.ai/project/1/model/mnist/version/gbstgnlgheydqnrtmftdgyjzpe4tezy -> local/project/self...
    🎳 download to /home/liutianwei/.cache/starwhale/self/model/mnist/gb/gbstgnlgheydqnrtmftdgyjzpe4tezy.swmp... ━━ 100% 0… 1
    👏 copy done.
    ```
