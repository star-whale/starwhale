#!/usr/bin/env bash

set -e

ARCH=""
SOURCES_LIST_PATH="/etc/apt/sources.list"

_do_render() {
    cat > $SOURCES_LIST_PATH << EOF
#Generated by Starwhale, for ${ARCH} arch
deb http://archive.canonical.com/ubuntu focal partner
EOF

    for addr in "$@"
    do
        cat >> $SOURCES_LIST_PATH << EOF
deb ${addr} focal main restricted universe multiverse
deb ${addr} focal-updates main restricted universe multiverse
deb ${addr} focal-backports main restricted universe multiverse
deb ${addr} focal-security main restricted universe multiverse
EOF
    done
}

main() {
    ARCH=$1
    echo "Render ${SOURCES_LIST_PATH} for ${ARCH}..."

    if [ "$1" = "amd64" ] || [ "$1" = "" ]; then
        _do_render "http://mirrors.tuna.tsinghua.edu.cn/ubuntu/" "http://archive.ubuntu.com/ubuntu/"
    else
        _do_render "http://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/" "http://ports.ubuntu.com/ubuntu-ports/"
    fi

    echo ">>> show $SOURCES_LIST_PATH content:"
    cat $SOURCES_LIST_PATH
}

#main $1
