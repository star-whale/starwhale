{"version":3,"file":"module2.js","sources":["../../../node_modules/.pnpm/fast-unique-numbers@6.0.21/node_modules/fast-unique-numbers/build/es2019/factories/add-unique-number.js","../../../node_modules/.pnpm/fast-unique-numbers@6.0.21/node_modules/fast-unique-numbers/build/es2019/factories/cache.js","../../../node_modules/.pnpm/fast-unique-numbers@6.0.21/node_modules/fast-unique-numbers/build/es2019/factories/generate-unique-number.js","../../../node_modules/.pnpm/fast-unique-numbers@6.0.21/node_modules/fast-unique-numbers/build/es2019/module.js","../../../node_modules/.pnpm/broker-factory@3.0.68/node_modules/broker-factory/build/es2019/guards/message-port.js","../../../node_modules/.pnpm/broker-factory@3.0.68/node_modules/broker-factory/build/es2019/helpers/port-map.js","../../../node_modules/.pnpm/broker-factory@3.0.68/node_modules/broker-factory/build/es2019/helpers/extend-broker-implementation.js","../../../node_modules/.pnpm/broker-factory@3.0.68/node_modules/broker-factory/build/es2019/module.js"],"sourcesContent":["export const createAddUniqueNumber = (generateUniqueNumber) => {\n    return (set) => {\n        const number = generateUniqueNumber(set);\n        set.add(number);\n        return number;\n    };\n};\n//# sourceMappingURL=add-unique-number.js.map","export const createCache = (lastNumberWeakMap) => {\n    return (collection, nextNumber) => {\n        lastNumberWeakMap.set(collection, nextNumber);\n        return nextNumber;\n    };\n};\n//# sourceMappingURL=cache.js.map","/*\n * The value of the constant Number.MAX_SAFE_INTEGER equals (2 ** 53 - 1) but it\n * is fairly new.\n */\nconst MAX_SAFE_INTEGER = Number.MAX_SAFE_INTEGER === undefined ? 9007199254740991 : Number.MAX_SAFE_INTEGER;\nconst TWO_TO_THE_POWER_OF_TWENTY_NINE = 536870912;\nconst TWO_TO_THE_POWER_OF_THIRTY = TWO_TO_THE_POWER_OF_TWENTY_NINE * 2;\nexport const createGenerateUniqueNumber = (cache, lastNumberWeakMap) => {\n    return (collection) => {\n        const lastNumber = lastNumberWeakMap.get(collection);\n        /*\n         * Let's try the cheapest algorithm first. It might fail to produce a new\n         * number, but it is so cheap that it is okay to take the risk. Just\n         * increase the last number by one or reset it to 0 if we reached the upper\n         * bound of SMIs (which stands for small integers). When the last number is\n         * unknown it is assumed that the collection contains zero based consecutive\n         * numbers.\n         */\n        let nextNumber = lastNumber === undefined ? collection.size : lastNumber < TWO_TO_THE_POWER_OF_THIRTY ? lastNumber + 1 : 0;\n        if (!collection.has(nextNumber)) {\n            return cache(collection, nextNumber);\n        }\n        /*\n         * If there are less than half of 2 ** 30 numbers stored in the collection,\n         * the chance to generate a new random number in the range from 0 to 2 ** 30\n         * is at least 50%. It's benifitial to use only SMIs because they perform\n         * much better in any environment based on V8.\n         */\n        if (collection.size < TWO_TO_THE_POWER_OF_TWENTY_NINE) {\n            while (collection.has(nextNumber)) {\n                nextNumber = Math.floor(Math.random() * TWO_TO_THE_POWER_OF_THIRTY);\n            }\n            return cache(collection, nextNumber);\n        }\n        // Quickly check if there is a theoretical chance to generate a new number.\n        if (collection.size > MAX_SAFE_INTEGER) {\n            throw new Error('Congratulations, you created a collection of unique numbers which uses all available integers!');\n        }\n        // Otherwise use the full scale of safely usable integers.\n        while (collection.has(nextNumber)) {\n            nextNumber = Math.floor(Math.random() * MAX_SAFE_INTEGER);\n        }\n        return cache(collection, nextNumber);\n    };\n};\n//# sourceMappingURL=generate-unique-number.js.map","import { createAddUniqueNumber } from './factories/add-unique-number';\nimport { createCache } from './factories/cache';\nimport { createGenerateUniqueNumber } from './factories/generate-unique-number';\n/*\n * @todo Explicitly referencing the barrel file seems to be necessary when enabling the\n * isolatedModules compiler option.\n */\nexport * from './types/index';\nconst LAST_NUMBER_WEAK_MAP = new WeakMap();\nconst cache = createCache(LAST_NUMBER_WEAK_MAP);\nconst generateUniqueNumber = createGenerateUniqueNumber(cache, LAST_NUMBER_WEAK_MAP);\nconst addUniqueNumber = createAddUniqueNumber(generateUniqueNumber);\nexport { addUniqueNumber, generateUniqueNumber };\n//# sourceMappingURL=module.js.map","export const isMessagePort = (sender) => {\n    return typeof sender.start === 'function';\n};\n//# sourceMappingURL=message-port.js.map","export const PORT_MAP = new WeakMap();\n//# sourceMappingURL=port-map.js.map","import { PORT_MAP } from './port-map';\nexport const extendBrokerImplementation = (partialBrokerImplementation) => ({\n    ...partialBrokerImplementation,\n    connect: ({ call }) => {\n        return async () => {\n            const { port1, port2 } = new MessageChannel();\n            const portId = await call('connect', { port: port1 }, [port1]);\n            PORT_MAP.set(port2, portId);\n            return port2;\n        };\n    },\n    disconnect: ({ call }) => {\n        return async (port) => {\n            const portId = PORT_MAP.get(port);\n            if (portId === undefined) {\n                throw new Error('The given port is not connected.');\n            }\n            await call('disconnect', { portId });\n        };\n    },\n    isSupported: ({ call }) => {\n        return () => call('isSupported');\n    }\n});\n//# sourceMappingURL=extend-broker-implementation.js.map","import { generateUniqueNumber } from 'fast-unique-numbers';\nimport { isMessagePort } from './guards/message-port';\nimport { extendBrokerImplementation } from './helpers/extend-broker-implementation';\n/*\n * @todo Explicitly referencing the barrel file seems to be necessary when enabling the\n * isolatedModules compiler option.\n */\nexport * from './interfaces/index';\nexport * from './types/index';\nconst ONGOING_REQUESTS = new WeakMap();\nconst createOrGetOngoingRequests = (sender) => {\n    if (ONGOING_REQUESTS.has(sender)) {\n        // @todo TypeScript needs to be convinced that has() works as expected.\n        return ONGOING_REQUESTS.get(sender);\n    }\n    const ongoingRequests = new Map();\n    ONGOING_REQUESTS.set(sender, ongoingRequests);\n    return ongoingRequests;\n};\nexport const createBroker = (brokerImplementation) => {\n    const fullBrokerImplementation = extendBrokerImplementation(brokerImplementation);\n    return (sender) => {\n        const ongoingRequests = createOrGetOngoingRequests(sender);\n        sender.addEventListener('message', (({ data: message }) => {\n            const { id } = message;\n            if (id !== null && ongoingRequests.has(id)) {\n                const { reject, resolve } = ongoingRequests.get(id);\n                ongoingRequests.delete(id);\n                if (message.error === undefined) {\n                    resolve(message.result);\n                }\n                else {\n                    reject(new Error(message.error.message));\n                }\n            }\n        }));\n        if (isMessagePort(sender)) {\n            sender.start();\n        }\n        const call = (method, params = null, transferables = []) => {\n            return new Promise((resolve, reject) => {\n                const id = generateUniqueNumber(ongoingRequests);\n                ongoingRequests.set(id, { reject, resolve });\n                if (params === null) {\n                    sender.postMessage({ id, method }, transferables);\n                }\n                else {\n                    sender.postMessage({ id, method, params }, transferables);\n                }\n            });\n        };\n        const notify = (method, params, transferables = []) => {\n            sender.postMessage({ id: null, method, params }, transferables);\n        };\n        let functions = {};\n        for (const [key, handler] of Object.entries(fullBrokerImplementation)) {\n            functions = { ...functions, [key]: handler({ call, notify }) };\n        }\n        return { ...functions };\n    };\n};\n//# sourceMappingURL=module.js.map"],"names":[],"mappings":"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"}